USE_OCAMLFIND  = true
BYTE_ENABLED   = true
NATIVE_ENABLED = true

OCAMLFINDFLAGS = -syntax camlp4o

OCAMLFLAGS = -g -w +a-4-6-9-27..29-30-32..99 -warn-error +a-4-6-9-18-27-28-29..99
OCAMLOPTFLAGS = -inline 1000

OCAMLPACKS[] =
   batteries
   lwt.unix
   lwt.syntax
   extprot

if $(not $(OCAMLFIND_EXISTS))
   eprintln(This project requires ocamlfind, but is was not found.)
   eprintln(You need to install ocamlfind and run "omake --configure".)
   exit 1

OBJECTS[] =
    oraft
    oraft_lwt
    oraft_proto
    RSM

OCamlGeneratedFiles(oraft_proto)

oraft_proto.ml: oraft_proto.proto
        extprotc $<

LIBS     = $(OCamlLibrary oraft, $(OBJECTS))

PROGRAMS = $(OCamlProgram test_DES, oraft test_DES)

%.sig: %.ml %.cmo
    $(OCAMLFIND) $(OCAMLC) -package camlp4.macro,$(concat \,, $(OCAMLPACKS)) \
        -syntax camlp4o \
        $(mapprefix -I, $(OCAMLINCLUDES)) \
        $(OCAMLFLAGS) $(OCAMLCFLAGS) -i $< > $@

.DEFAULT: $(LIBS) $(PROGRAMS)

# vim: set expandtab:
